
00010          .LI ON
00020 ------------------------------
00030 ; TURBO-BASIC TEIL 10
00040 ------------------------------
00050          .LI OFF
00060 ------------------------------
00070 L0031  LDX #$FF
00080        TXS
00090        CLD
00100        LDA PROG_CLR
00110        BEQ L0948  
00120 ------------------------------
00130 ***         NEW           ***
00140 NEW_BEF  JSR NEW_BAS_PTR  
00150 L0948    JSR CLR_DIV_PTR
00160 L0579    JSR IO_CL_ALL
00170 L0623    JSR L0620
00180          LDA ZP092
00190          BEQ L0950
00200          JSR L0596
00210 L0950    JSR PRINT_READY
00220 Y1182    JSR L0489
00230 L0561    LDA PROG_CLR
00240          BNE NEW_BEF
00250          LDX #$FF
00260          TXS
00270          CLD
00280          JSR SET_INBUFF_580
00290          LDA #$5D
00300          STA ZP0C2
00310          JSR L0552
00320          LDA BRKKEY
00330          BNE L0953
00340          DEC BRKKEY
00350          BNE L0561
00360 L0953    LDY #$00
00370          STY CIX
00380          STY ZEIL_LEN
00390          STY ZP094
00400          STY ZP0A6
00410          STY ZP0B3
00420          STY ZP0B0
00430          STY ZP0B1
00440          LDA VNTD
00450          STA ZP0AD
00460          LDA VNTD+1
00470          STA ZP0AE
00480          JSR L0957
00490          JSR L0958
00500          JSR L0959
00510          LDA FR0+1
00520          BPL L0960
00530          STA ZP0A6
00540 L0960    JSR L0957
00550          STY STATE_PTR
00560          LDA (INBUFF),Y
00570          CMP #$9B
00580          BNE L0961
00590          BIT ZP0A6
00600          BMI L0561
00610          JMP L0962
00620 ------------------------------
00630 L0961  LDA ZP094
00640        STA STATE_LEN
00650        JSR L0959  
00660        JSR L0957  
00670        LDY /BEF_LIS
00680        LDA #BEF_LIS
00690        JSR L0963  
00700        ROR ZP0EC
00710        BMI L0964  
00720        LDA ZP0AF
00730        CMP #$15
00740        BNE L0965  
00750        STX ZP0DA
00760 L0964  LDY /BEF_XLIS
00770        LDA #BEF_XLIS
00780        JSR L0963  
00790        LDA #$36
00800        BCS L0966  
00810        ADC ZP0AF
00820        ADC #$02
00830        BCC L0965  
00840 L0966  BIT ZP0EC
00850        BMI L0965  
00860        LDA #BEF_LIS1
00870        STA ZP095
00880        LDA /BEF_LIS1
00890        STA ZP096
00900        LDA #$15
00910        LDX ZP0DA
00920 L0965  STX CIX
00930        JSR L0959  
00940        JSR CALL_ASC_SUCH
00950        JSR L0968  
00960        BCC L0969  
00970        LDY ZEIL_LEN
00980        LDA (INBUFF),Y
00990        CMP #$9B
01000        BNE L0970  
01010        INY
01020        STA (INBUFF),Y
01030        DEY
01040        LDA #$20
01050 L0970  ORA #$80
01060        STA (INBUFF),Y
01070        LDA #$40
01080        ORA ZP0A6
01090        STA ZP0A6
01100        LDY STATE_PTR
01110        STY CIX
01120        LDX #$03
01130        STX STATE_LEN
01140        INX
01150        STX ZP094
01160        LDA #$37
01170 L0971  JSR L0959  
01180 L1012  LDY CIX
01190        LDA (INBUFF),Y
01200        INC CIX
01210        CMP #$9B
01220        BNE L0971  
01230        JSR L0959  
01240 L0969  LDA ZP094
01250        LDY STATE_LEN
01260        STA XTAB3,Y  
01270        LDY CIX
01280        DEY
01290        LDA (INBUFF),Y
01300        CMP #$9B
01310        BEQ L0972  
01320        JMP L0961  
01330 L0972  LDY #$02
01340        LDA ZP094
01350        STA XTAB3,Y  
01360        JSR L0467  
01370        LDA #$00
01380        BCS L0973  
01390        LDY #$02
01400        LDA (STMCUR),Y
01410 L0973  SEC
01420        SBC ZP094
01430        BEQ L0974  
01440        BCS L0975  
01450        EOR #$FF
01460        TAY
01470        INY
01480        LDX #$8A
01490        JSR L0468  
01500        LDA ZP097
01510        STA STMCUR
01520        LDA ZP098
01530        STA STMCUR+1
01540        BNE L0974  
01550 L0975  TAY
01560        CLC
01570        ADC STMCUR
01580        STA STMCUR
01590        BCC L0976  
01600        INC STMCUR+1
01610 L0976  LDX #$8A
01620        JSR L0495  
01630 L0974  LDY ZP094
01640 L0977  DEY
01650        LDA XTAB3,Y  
01660        STA (STMCUR),Y
01670        TYA
01680        BNE L0977  
01690        BIT ZP0A6
01700        BVC L0978  
01710        LDA ZP0B1
01720        ASL
01730        ASL
01740        ASL
01750        TAY
01760        LDX #$88
01770        JSR L0495  
01780        SEC
01790        LDA VNTD
01800        SBC ZP0AD
01810        TAY
01820        LDA VNTD+1
01830        SBC ZP0AE
01840        LDX #$84
01850        JSR L0979  
01860        BIT ZP0A6
01870        BPL L0980  
01880        JSR L0981  
01890        JMP L0561  
01900 L0980  JSR L0982  
01910 L0983  JMP L0561  
01920 L0978  BPL L0983  
01930 L0095  JSR L0497  
01940        JMP L0984  
01950 L0962  JSR L0467  
01960        BCS L0983  
01970        LDY #$02
01980        LDA (STMCUR),Y
01990        TAY
02000        CLC
02010        ADC STMCUR
02020        STA STMCUR
02030        BCC L0985  
02040        INC STMCUR+1
02050 L0985  LDX #$8A
02060        JSR L0495  
02070        JMP L0561  
02080 L0958  JSR CALL_ASC_FP
02090        BCC .2
02100 .1     LDA #$00
02110        STA CIX
02120        LDY #$80
02130        BMI .3
02140 .2     JSR L0431
02150        BCS .1
02160        LDY FR0+1
02170        BMI .1
02180        LDA FR0
02190 .3     STY ZP0A1
02200        STA ZP0A0
02210        JSR L0959  
02220        LDA ZP0A1
02230        STA FR0+1
02240        JMP L0959  
02250 L0968  LDY #$00
02260        STY ZP0A9
02270        LDA (ZP095),Y
02280        ASL
02290        TAY
02300        LDA L0989,Y  
02310        STA ZP09D
02320        STA ADR_482  
02330        LDA L0991,Y  
02340        STA ZP09E
02350        STA ADR_483  
02360        LDA ZP094
02370        STA ADR_481  
02380        LDA CIX
02390        STA ADR_480  
02400 L0999  INC ZP09D
02410        BNE L0995  
02420        INC ZP09E
02430 L0995  LDX #$00
02440        LDA (ZP09D,X)
02450        BMI L0996  
02460        CMP #$05
02470        BCC L0997  
02480        JSR L0998  
02490        BCC L0999  
02500        JMP L1000  
02510 L0996  ASL
02520        TAY
02530        LDA L0991,Y  
02540        PHA
02550        LDA L0989,Y  
02560        PHA
02570        CPY #$12
02580        BCS .2
02590        PLA
02600        TAY
02610        PLA
02620        JSR .1
02630        BCC L0999  
02640        JMP L1000  
02650 .1     PHA
02660        TYA
02670        PHA
02680        RTS
02690 .2     LDX ZP0A9
02700        INX
02710        INX
02720        INX
02730        INX
02740        BEQ .3
02750        STX ZP0A9
02760        LDA CIX
02770        STA ADR_480,X  
02780        LDA ZP094
02790        STA ADR_481,X  
02800        LDA ZP09D
02810        STA ADR_482,X  
02820        LDA ZP09E
02830        STA ADR_483,X  
02840        PLA
02850        STA ZP09D
02860        PLA
02870        STA ZP09E
02880        JMP L0999  
02890 .3     JMP ERROR14_1
02900 L0997  LDX ZP0A9
02910        BNE .1
02920        RTS
02930 .1     LDA ADR_482,X
02940        STA ZP09D
02950        LDA ADR_483,X  
02960        STA ZP09E
02970        DEX
02980        DEX
02990        DEX
03000        DEX
03010        STX ZP0A9
03020        BCS L1000  
03030        JMP L0999  
03040 L1000  INC ZP09D
03050        BNE L1006  
03060        INC ZP09E
03070 L1006  LDX #$00
03080        LDA (ZP09D,X)
03090        BMI L1000  
03100        CMP #$03
03110        BEQ L0997  
03120        BCS L1000  
03130        LDA CIX
03140        CMP ZEIL_LEN
03150        BCC L1007  
03160        STA ZEIL_LEN
03170 L1007  LDX ZP0A9
03180        LDA ADR_480,X  
03190        STA CIX
03200        LDA ADR_481,X  
03210        STA ZP094
03220        JMP L0999  
03230 L1010  RTS
03240 L0998  CMP #$0F
03250        BNE L1008  
03260        INC ZP09D
03270        BNE L1009  
03280        INC ZP09E
03290 L1009  LDX #$00
03300        LDA (ZP09D,X)
03310        CLC
03320        DEC ZP094
03330 L0959  LDY ZP094
03340        STA XTAB3,Y  
03350        INC ZP094
03360        BNE L1010  
03370 ------------------------------
03380 ERROR14_1 LDA #$0E
03390           JMP ERROR_ROUT
03400 ------------------------------
03410 Y1281  LDX #$FF
03420        TXS
03430        LDA ZP094
03440        LDY STATE_LEN
03450        STA XTAB3,Y  
03460        JMP L0961  
03470 Y1277  LDX #$FF
03480        TXS
03490        LDY #$04
03500        LDA XTAB3,Y  
03510        CMP #$54
03520        BNE L1011  
03530        LDY CIX
03540        DEY
03550        LDA #$9B
03560        STA (INBUFF),Y
03570        JMP L0969  
03580 L1011  JMP L1012  
03590 L1008  JSR L0957  
03600        CPY ZP0B3
03610        BEQ L1013  
03620        STY ZP0B3
03630        LDY /FUNK_LIS
03640        LDA #FUNK_LIS
03650        JSR L1014  
03660        BCS L1015  
03670        STX ZP0B2
03680        CLC
03690        LDA ZP0AF
03700        ADC #$10
03710        STA ZP0B0
03720 L1013  LDY #$00
03730        LDA (ZP09D),Y
03740        CMP ZP0B0
03750        BEQ L1016  
03760        CMP #$44
03770        BNE L1017  
03780        LDA ZP0B0
03790        CMP #$56
03800        BCS L1017  
03810        CMP #$44
03820        BCS L1018  
03830 L1017  SEC
03840        RTS
03850 L1018  LDA ZP0B0
03860 L1016  JSR L0959  
03870        LDX ZP0B2
03880        STX CIX
03890        CLC
03900        RTS
03910 L1015  LDA #$00
03920        STA ZP0B0
03930        SEC
03940        RTS
03950 Y1283  LDA #$C0
03960        BNE L1019  
03970 Y1279  LDA #$00
03980        BEQ L1019  
03990 Y1282  LDA #$80
04000 L1019  STA ZP0D2
04010        JSR L0957  
04020        STY ZP0AC
04030        JSR L1020  
04040        BCS L1021  
04050        JSR L1008  
04060        LDA ZP0B0
04070        BEQ L1022  
04080        LDY ZP0B2
04090        LDA (INBUFF),Y
04100        CMP #$30
04110        BCC L1021  
04120 L1022  INC CIX
04130        JSR L1020  
04140        BCC L1022  
04150        CMP #$30
04160        BCC L1023  
04170        CMP #$3A
04180        BCC L1022  
04190 L1023  CMP #$24
04200        BEQ Y1002
04210        BIT ZP0D2
04220        BPL Y1003
04230        BVS Y1004
04240 L1021  SEC
04250        RTS
04260 Y1002  BIT ZP0D2
04270        BPL L1021  
04280        BVS L1021  
04290        INY
04300        BNE Y1004
04310 Y1003  LDA (INBUFF),Y
04320        CMP #$28
04330        BNE Y1004
04340        INY
04350        LDA #$40
04360        ORA ZP0D2
04370        STA ZP0D2
04380 Y1004  LDA ZP0AC
04390        STA CIX
04400        STY ZP0AC
04410        LDY VNTP+1
04420        LDA VNTP
04430        JSR L1014  
04440 Y1008  BCS Y1005
04450        CPX ZP0AC
04460        BEQ Y1006
04470 Y1011  JSR Y1007
04480        JMP Y1008
04490 Y1005  SEC
04500        LDA ZP0AC
04510        SBC CIX
04520        STA CIX
04530        TAY
04540        LDX #$84
04550        JSR L0468  
04560        LDA ZP0AF
04570        STA ZP0D3
04580        LDY CIX
04590        DEY
04600        LDX ZP0AC
04610        DEX
04620        LDA ADR_580,X  
04630        ORA #$80
04640 Y1009  STA (ZP097),Y
04650        DEX
04660        LDA ADR_580,X  
04670        DEY
04680        BPL Y1009
04690        LDY #$08
04700        LDX #$88
04710        JSR L0468  
04720        INC ZP0B1
04730        JSR CLEAR_FR0
04740        LDY #$07
04750 Y1010  LDA ZP0D2,Y
04760        STA (ZP097),Y
04770        DEY
04780        BPL Y1010
04790 Y1006  TYA
04800        PHA
04810        LDA ZP09D
04820        PHA
04830        LDX ZP09E
04840        LDA ZP0AF
04850        JSR CALC_VARTAB  
04860        LDA (ZP09D),Y
04870        EOR ZP0D2
04880        TAY
04890        STX ZP09E
04900        PLA
04910        STA ZP09D
04920        CPY #$80
04930        PLA
04940        TAY
04950        BCS Y1011
04960        BIT ZP0D2
04970        BVC Y1012
04980        BMI Y1012
04990        DEC ZP0AC
05000 Y1012  LDA ZP0AC
05010        STA CIX
05020        LDA ZP0AF
05030        BPL Y1013
05040        LDA #$00
05050        JSR L0959  
05060        LDA ZP0AF
05070 Y1013  EOR #$80
05080        JSR L0959
05090 Y1014  CLC
05100        RTS
05110 L1020  LDY CIX
05120        LDA (INBUFF),Y
05130 Y1081  CMP #$5F
05140        BEQ Y1014
05150        CMP #$41
05160        BCC Y1015
05170        CMP #$5B
05180        RTS
05190 Y1020  LDY ZP0AC
05200        STY CIX
05210 Y1015  SEC
05220        RTS
05230 L0794  LDY CIX
05240        LDA (INBUFF),Y
05250        SEC
05260        SBC #$30
05270        BCC Y1015
05280        CMP #$0A
05290        BCC .1
05300        CMP #$11
05310        BCC Y1015
05320        SBC #$07
05330        CMP #$10
05340        BCS Y1015
05350 .1     LDY #$04
05360 .2     ASL FR0
05370        ROL FR0+1
05380        DEY
05390        BNE .2
05400        ORA FR0
05410        STA FR0
05420        INC CIX
05430        CLC
05440        RTS
05450 Y1278  JSR L0957
05460        STY ZP0AC
05470        LDA (INBUFF),Y
05480        CMP #$24
05490        BEQ .1
05500        JSR CALL_ASC_FP
05510        BCC .4
05520        BCS Y1020
05530 .1     INC CIX
05540        JSR L0957
05550        JSR CLEAR_FR0
05560        JSR L0794
05570        BCS Y1020
05580 .2     JSR L0794
05590        BCS .3
05600        LDA FR0+1
05610        AND #$F0
05620        BEQ .2
05630 .3     JSR L0124
05640        LDA #$0D
05650        .HX 2C
05660 .4     LDA #$0E
05670        JSR L0959  
05680        LDY ZP094
05690        LDX #$00
05700 .5     LDA FR0,X
05710        STA XTAB3,Y  
05720        INY
05730        INX
05740        CPX #$06
05750        BCC .5
05760        STY ZP094
05770        CLC
05780        RTS
05790 Y1280  JSR L0957
05800        LDA (INBUFF),Y
05810        CMP #$22
05820        BEQ .1
05830        SEC
05840        RTS
05850 .1     LDA #$0F
05860        JSR L0959  
05870        LDA ZP094
05880        STA ZP0AB
05890 .2     JSR L0959
05900        INC CIX
05910        LDY CIX
05920        LDA (INBUFF),Y
05930        CMP #$9B
05940        BEQ .3
05950        CMP #$22
05960        BNE .2
05970        INC CIX
05980        INY
05990        LDA (INBUFF),Y
06000        CMP #$22
06010        BEQ .2
06020 .3     CLC
06030        LDA ZP094
06040        SBC ZP0AB
06050        LDY ZP0AB
06060        STA XTAB3,Y  
06070        CLC
06080        RTS
06090 Y1284  LDA XTAB3+1
06100        ASL
06110        BCS .1
06120        LDA ZP094
06130        CMP #$06
06140 .1     RTS
06150 L0957  LDY CIX
06160 .1     LDA (INBUFF),Y
06170        AND #$7F
06180        CMP #$20
06190        BNE .2
06200        INY
06210        BNE .1
06220 .2     STY CIX
06230 .3     LDA (INBUFF),Y
06240        CMP #$9B
06250        BEQ .5
06260        AND #$7F
06270        STA (INBUFF),Y
06280        CMP #$61
06290        BCC .4
06300        CMP #$7B
06310        BCS .4
06320        AND #$5F
06330        STA (INBUFF),Y
06340 .4     INY
06350        CMP #$30
06360        BCC .5
06370        CMP #$3A
06380        BCC .3
06390        CMP #$41
06400        BCC .5
06410        CMP #$5B
06420        BCC .3
06430        CMP #$5F
06440        BEQ .3
06450 .5     LDY CIX
06460        RTS
06470 ------------------------------
06480 ; ENDE TEIL 10
06490 ------------------------------
